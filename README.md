# AI_THE_SPIRE

<div align="center">

[![Python](https://img.shields.io/badge/Python-3.14+-blue.svg)](https://www.python.org/)
[![PyTorch](https://img.shields.io/badge/PyTorch-2.0+-red.svg)](https://pytorch.org/)
[![RL](https://img.shields.io/badge/RL-stable--baselines3-green.svg)](https://github.com/DLR-RM/stable-baselines3)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)

### åŸºäº Reinforcement Learning çš„ã€ŠSlay the Spireã€‹AI é¡¹ç›®

**ç›®æ ‡**ï¼šåœ¨ Ascension 20 éš¾åº¦ä¸‹ï¼Œä½¿ç”¨é™é»˜çŒæ‰‹æŒ‘æˆ˜ NoSL æ¨¡å¼

**æŠ€æœ¯è·¯çº¿**ï¼šè§„åˆ™åŸºçº¿ â†’ ç›‘ç£å­¦ä¹ ï¼ˆä»äººç±»æ•°æ®ï¼‰ â†’ å¼ºåŒ–å­¦ä¹ ï¼ˆè‡ªæˆ‘ä¼˜åŒ–ï¼‰

</div>

---

## ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [çŠ¶æ€ç¼–ç å™¨ V2](#çŠ¶æ€ç¼–ç å™¨-v2)
- [åŠ¨ä½œç©ºé—´](#åŠ¨ä½œç©ºé—´)
- [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å¼€å‘æ–‡æ¡£](#å¼€å‘æ–‡æ¡£)
- [æ›´æ–°æ—¥å¿—](#æ›´æ–°æ—¥å¿—)

---

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®ä½¿ç”¨**å¼ºåŒ–å­¦ä¹ æŠ€æœ¯**è®­ç»ƒ AI è‡ªä¸»å­¦ä¹ ã€Šæ€æˆ®å°–å¡”ã€‹çš„æ¸¸æˆç­–ç•¥ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ® **é™é»˜çŒæ‰‹ä¸“ç”¨**ï¼šé’ˆå¯¹ A20 éš¾åº¦ + é™é»˜èŒä¸šä¼˜åŒ–
- ğŸ“Š **çŠ¶æ€ç¼–ç å™¨**ï¼š2945 ç»´ S å‘é‡ï¼Œè¦†ç›–å®Œæ•´æ¸¸æˆçŠ¶æ€
- ğŸ¯ **åŠ¨ä½œç©ºé—´**ï¼š179 ç»´ç¦»æ•£åŠ¨ä½œï¼Œæ”¯æŒæ‰€æœ‰æ¸¸æˆæ“ä½œ
- ğŸ”„ **å®Œæ•´è®­ç»ƒæµç¨‹**ï¼šä» Mod Log â†’ é¢„å¤„ç† â†’ è®­ç»ƒ â†’ è¯„ä¼°
- ğŸ›¡ï¸ **Action Masking**ï¼šåªé€‰æ‹©å½“å‰åˆæ³•åŠ¨ä½œ

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| æ¸¸æˆé€šä¿¡ | [CommunicationMod](https://github.com/ForgottenArbiter/CommunicationMod) | JSON åè®® |
| çŠ¶æ€ç¼–ç  | è‡ªå®šä¹‰ç¼–ç å™¨ | 2945 ç»´ S å‘é‡ |
| RL æ¡†æ¶ | Gymnasium + Stable-Baselines3 | PPO/A2C ç®—æ³• |
| ç¥ç»ç½‘ç»œ | PyTorch | ç­–ç•¥ç½‘ç»œ + ä»·å€¼ç½‘ç»œ |
| é…ç½®ç®¡ç† | YAML | çµæ´»çš„é…ç½®ç³»ç»Ÿ |

---

## ç³»ç»Ÿæ¶æ„

### è®­ç»ƒæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mod Log    â”‚  çœŸå®æ¸¸æˆæ•°æ®
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¢„å¤„ç†     â”‚  (s, a) å¯¹ç”Ÿæˆ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç›‘ç£å­¦ä¹     â”‚  è¡Œä¸ºå…‹éš†
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¼ºåŒ–å­¦ä¹     â”‚  PPO/A2C ä¼˜åŒ–
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¯„ä¼°      â”‚  æ€§èƒ½æµ‹è¯•
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è®­ç»ƒå…¥å£                            â”‚
â”‚                    scripts/train.py                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ pipeline â”‚ collect â”‚ sl â”‚ rl â”‚ eval â”‚ interactive â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒæ¨¡å—å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ ¸å¿ƒ    â”‚  â”‚    è®­ç»ƒ      â”‚  â”‚    æ™ºèƒ½ä½“     â”‚  â”‚  ç¯å¢ƒ   â”‚  â”‚
â”‚  â”‚          â”‚  â”‚              â”‚  â”‚              â”‚  â”‚         â”‚  â”‚
â”‚  â”‚ action.pyâ”‚  â”‚ encoder.py  â”‚  â”‚supervised.py â”‚ â”‚sts_env.pyâ”‚ â”‚
â”‚  â”‚config.py â”‚  â”‚encoder_dims.pyâ”‚  â”‚  rl_agent.py â”‚  â”‚         â”‚  â”‚
â”‚  â”‚game_stateâ”‚  â”‚encoder_utilsâ”‚  â”‚rule_based.py â”‚  â”‚         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚power_parserâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          Mod Log åŸå§‹æ•°æ®                              â”‚  â”‚
â”‚  â”‚  data/A20_Silent/Raw_Data_json_FORSL/*.json             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          é¢„å¤„ç†åçš„è®­ç»ƒæ•°æ®                            â”‚  â”‚
â”‚  â”‚  data/training_data_*.json                             â”‚  â”‚
â”‚  â”‚  data/s_vectors.npy / data/actions.npy                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## çŠ¶æ€ç¼–ç å™¨ V2

### æ€»è§ˆ

**æ€»ç»´åº¦**ï¼š2945 ç»´
**è®¾è®¡åŸåˆ™**ï¼šé™é»˜çŒæ‰‹ä¸“ç”¨ï¼ˆA20 å›ºå®šéš¾åº¦ï¼‰
**æ•°æ®æ¥æº**ï¼š100% åŸºäº Mod æ—¥å¿—å­—æ®µ

### åŒºå—ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŒºå—          | èŒƒå›´        | ç»´åº¦  | å†…å®¹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç©å®¶æ ¸å¿ƒ      â”‚ [0-16]      â”‚  17  â”‚ HP/èƒ½é‡/æŠ¤ç”²/é‡‘å¸/é’¥åŒ™               â”‚
â”‚ æ‰‹ç‰Œ         â”‚ [17-406]    â”‚ 390  â”‚ 144 multi-hot + 21Ã—10 + ç»Ÿè®¡        â”‚
â”‚ æŠ½ç‰Œå †       â”‚ [407-746]   â”‚ 340  â”‚ 144 multi-hot + è¯¦ç»†ç»Ÿè®¡             â”‚
â”‚ å¼ƒç‰Œå †       â”‚ [747-1086]  â”‚ 340  â”‚ åŒä¸Š                               â”‚
â”‚ æ¶ˆè€—å †       â”‚ [1087-1326] â”‚ 240  â”‚ åŒä¸Š                               â”‚
â”‚ ç©å®¶Powers  â”‚ [1327-1426] â”‚ 100  â”‚ Poweræ•ˆæœ                           â”‚
â”‚ æ€ªç‰©         â”‚ [1427-2045] â”‚ 618  â”‚ 6æ€ªç‰©Ã—103ç»´                        â”‚
â”‚ é—ç‰©         â”‚ [2045-2244] â”‚ 200  â”‚ 180 multi-hot + ç»Ÿè®¡                  â”‚
â”‚ è¯æ°´         â”‚ [2245-2444] â”‚ 200  â”‚ 45 multi-hot + æ§½ä½ä¿¡æ¯               â”‚
â”‚ å…¨å±€         â”‚ [2445-2944] â”‚ 500  â”‚ æ¥¼å±‚/äº‹ä»¶/åœ°å›¾/æˆ˜æ–—åŠ¨æ€/ç‰Œç»„å˜åŒ–      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŒºå—10ï¼šå…¨å±€çŠ¶æ€è¯¦ç»†ç»“æ„ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰

```
[0-22]      åŸºç¡€ä¿¡æ¯ï¼ˆæ¥¼å±‚ã€ç« èŠ‚ã€æˆ¿é—´é˜¶æ®µã€å¯ç”¨å‘½ä»¤ï¼‰
[23-72]     äº‹ä»¶ID one-hot (50ç»´)
[73-87]     æˆ¿é—´ç»†åˆ†ç±»å‹ one-hot (15ç»´)
[88-112]    åœ°å›¾è·¯å¾„ä¿¡æ¯ (25ç»´)
[113-136]   æ›´å¤šbuff/debuffçŠ¶æ€ (24ç»´)
[137-200]   åœ°å›¾ç¼–ç  (64ç»´)
[201-209]   é‡è¦å­—æ®µ (9ç»´)
            â”œâ”€â”€ å•†åº—åˆ ç‰Œä¿¡æ¯ (2ç»´)
            â”œâ”€â”€ æ­£åœ¨æ‰“å‡ºçš„ç‰Œ (2ç»´)
            â”œâ”€â”€ å—å‡»æ¬¡æ•° (1ç»´)
            â””â”€â”€ å¥–åŠ±ç±»å‹ (4ç»´)
[210-320]   â­ æˆ˜æ–—åŠ¨æ€ä¿¡æ¯ (111ç»´) - æ–°å¢
            â”œâ”€â”€ limboç‰Œä¿¡æ¯ (3ç»´)
            â”œâ”€â”€ æ€ªç‰©è¡Œä¸ºæ¨¡å¼ (8ç»´)
            â”œâ”€â”€ é¢„è®¡ä¼¤å®³æ¥æº (10ç»´)
            â””â”€â”€ æœ¬å›åˆåŠ¨æ€ (20ç»´)
[321-400]   â­ ç‰Œç»„å˜åŒ–ç»Ÿè®¡ (80ç»´) - æ–°å¢
            â”œâ”€â”€ ç‰Œç»„æ„æˆå˜åŒ– (15ç»´)
            â”œâ”€â”€ å·²æ¶ˆè€—ç‰Œç»Ÿè®¡ (35ç»´)
            â””â”€â”€ å‡çº§ç‰Œç»Ÿè®¡ (15ç»´)
[401-499]   é¢„ç•™ (99ç»´)
```

### æ–°å¢åŠŸèƒ½ï¼ˆ2026-02-07ï¼‰

| åŠŸèƒ½ | è¯´æ˜ | Mod æ—¥å¿—æ¥æº |
|------|------|---------------|
| **æˆ˜æ–—åŠ¨æ€** | limbo ç‰Œã€æ€ªç‰©è¡Œä¸ºæ¨¡å¼ã€é¢„è®¡ä¼¤å®³ | `combat_state.limbo`, `monsters[].last_move_id` |
| **ç‰Œç»„å˜åŒ–** | ç‰Œç»„æ„æˆã€å·²æ¶ˆè€—ç‰Œã€å‡çº§ç‰Œç»Ÿè®¡ | `game_state.deck`, `combat_state.exhaust_pile` |

### é™é»˜ä¸“ç”¨ä¼˜åŒ–

| åˆ é™¤é¡¹ | åŸå›  |
|--------|------|
| è§’è‰²ç¼–ç  (3ç»´) | å›ºå®šé™é»˜çŒæ‰‹ |
| éš¾åº¦ç¼–ç  (1ç»´) | å›ºå®š A20 |
| Orbs ç¼–ç  (15ç»´) | é™é»˜ä¸ç”¨èƒ½é‡çƒ |
| å…¶ä»–èŒä¸šå¡ç‰Œ | åªä¿ç•™é™é»˜ 75 å¼  |

### å¡ç‰Œæ± 

```
æ€»å¡ç‰Œæ•°ï¼š144 å¼ 
â”œâ”€â”€ UNKNOWN     1 å¼ ï¼ˆå ä½ç¬¦ï¼‰
â”œâ”€â”€ è¯…å’’        14 å¼ 
â”œâ”€â”€ çŠ¶æ€        5 å¼ 
â”œâ”€â”€ é™é»˜èŒä¸š    75 å¼ 
â””â”€â”€ æ— è‰²        47 ç§ï¼ˆäº‹ä»¶/å•†åº—/é—ç‰©è·å¾—ï¼‰
```

---

## åŠ¨ä½œç©ºé—´

### 179 ç»´ç¦»æ•£åŠ¨ä½œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åŠ¨ä½œç±»å‹      | ID èŒƒå›´      | æ•°é‡  | è¯´æ˜                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‡ºç‰ŒåŠ¨ä½œ      | 0-69         | 70   â”‚ 10å¼ ç‰Œ Ã— 7ä¸ªç›®æ ‡              â”‚
â”‚ ä½¿ç”¨è¯æ°´      | 70-74        | 5    â”‚ ä¸æŒ‡å®šç›®æ ‡                     â”‚
â”‚ ä½¿ç”¨è¯æ°´(ç›®æ ‡) | 75-104       | 30   â”‚ å¯¹æ•Œäºº1-6                     â”‚
â”‚ ä¸¢å¼ƒè¯æ°´      | 105-109      | 5    â”‚                                 â”‚
â”‚ é€‰æ‹©é€‰é¡¹      | 110-169      | 60   â”‚ äº‹ä»¶/å•†åº—/å¡ç‰Œå¥–åŠ±            â”‚
â”‚ ç»“æŸå›åˆ      | 170          | 1    â”‚ ACTION_END_ID                  â”‚
â”‚ ç¡®è®¤/å‰è¿›    | 171          | 1    â”‚                                 â”‚
â”‚ ç¡®è®¤æŒ‰é’®      | 172          | 1    â”‚                                 â”‚
â”‚ å…¶ä»–æ§åˆ¶      | 173-178      | 6    â”‚ cancel/key/click/return/skip/leaveâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åŠ¨ä½œæ©ç  (Action Masking)

æ¯ä¸€æ­¥è¿”å›å½“å‰å¯ç”¨çš„åŠ¨ä½œæ©ç ï¼ŒAI åªéœ€ä»å¯ç”¨åŠ¨ä½œä¸­é€‰æ‹©ï¼š

```python
# ç¤ºä¾‹ï¼šæˆ˜æ–—ä¸­æœ‰ 6 å¼ å¯æ‰“å‡ºçš„ç‰Œ
action_mask = {0: 1, 1: 1, 2: 1, 3: 1, 4: 1, 5: 1, 100: 1}

# ç¤ºä¾‹ï¼šäº‹ä»¶é€‰æ‹©
action_mask = {110: 1, 111: 1, 112: 1}  # 3ä¸ªé€‰é¡¹å¯ç”¨
```

---

## æ•°æ®æµç¨‹

### å®Œæ•´æ•°æ®å¤„ç†æµç¨‹

```
1. Mod Log åŸå§‹æ•°æ®
   data/A20_Silent/Raw_Data_json_FORSL/*.json
   â†“
2. é¢„å¤„ç† (scripts/preprocess_training_data.py)
   â”œâ”€â”€ encode(): ç”Ÿæˆ S å‘é‡ (2945ç»´)
   â”œâ”€â”€ create_action_mask(): ç”ŸæˆåŠ¨ä½œæ©ç 
   â””â”€â”€ infer_actual_action(): æ¨æ–­å®é™…æ‰§è¡Œçš„åŠ¨ä½œ
   â†“
3. è®­ç»ƒæ•°æ®æ–‡ä»¶
   â”œâ”€â”€ training_data_*.json    # å®Œæ•´æ•°æ® (å«å…ƒæ•°æ®)
   â”œâ”€â”€ s_vectors.npy           # çŠ¶æ€çŸ©é˜µ (N Ã— 2945)
   â””â”€â”€ actions.npy             # åŠ¨ä½œæ ‡ç­¾ (N,)
   â†“
4. è®­ç»ƒ
   â”œâ”€â”€ ç›‘ç£å­¦ä¹ ï¼šä» (s, a) å­¦ä¹ ç­–ç•¥
   â””â”€â”€ å¼ºåŒ–å­¦ä¹ ï¼šç”¨ (s, action_mask) ä¼˜åŒ–ç­–ç•¥
```

### é¢„å¤„ç†è„šæœ¬åŠŸèƒ½

**è„šæœ¬**ï¼š`scripts/preprocess_training_data.py`

**åŠŸèƒ½**ï¼š
- ä» Mod Log ç”Ÿæˆ (s, a) è®­ç»ƒå¯¹
- æ”¯æŒå•æ–‡ä»¶å’Œæ‰¹é‡å¤„ç†
- è‡ªåŠ¨æ¨æ–­å®é™…æ‰§è¡Œçš„åŠ¨ä½œ
- ç”Ÿæˆ JSON å’Œ NumPy ä¸¤ç§æ ¼å¼

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
# å•æ–‡ä»¶å¤„ç†
python scripts/preprocess_training_data.py \
    -i data/A20_Silent/Raw_Data_json_FORSL/file.json \
    -o data/training_data.json

# æ‰¹é‡å¤„ç†
python scripts/preprocess_training_data.py -b \
    -i data/A20_Silent/Raw_Data_json_FORSL \
    -o data/processed/
```

---

## é¡¹ç›®ç»“æ„

```
AI_THE_SPIRE/
â”œâ”€â”€ src/                           # æºä»£ç 
â”‚   â”œâ”€â”€ core/                       # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ action.py              # åŠ¨ä½œç©ºé—´å®šä¹‰ (179ç»´)
â”‚   â”‚   â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ game_state.py          # æ¸¸æˆçŠ¶æ€ç±»
â”‚   â”‚
â”‚   â”œâ”€â”€ training/                   # è®­ç»ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ encoder.py             # â­ çŠ¶æ€ç¼–ç å™¨ (2945ç»´)
â”‚   â”‚   â”œâ”€â”€ encoder_dims.py        # â­ ç»´åº¦å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ encoder_utils.py       # ID æ˜ å°„å·¥å…·
â”‚   â”‚   â””â”€â”€ power_parser.py         # Power è§£æ
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                    # æ™ºèƒ½ä½“
â”‚   â”‚   â”œâ”€â”€ base.py                # Agent åŸºç±»
â”‚   â”‚   â”œâ”€â”€ supervised.py          # ç›‘ç£å­¦ä¹  Agent
â”‚   â”‚   â”œâ”€â”€ rl_agent.py            # å¼ºåŒ–å­¦ä¹  Agent
â”‚   â”‚   â””â”€â”€ rule_based.py          # åŸºäºè§„åˆ™çš„ Agent
â”‚   â”‚
â”‚   â””â”€â”€ env/                       # ç¯å¢ƒæ¨¡å—
â”‚       â””â”€â”€ sts_env.py             # Gymnasium ç¯å¢ƒæ¥å£
â”‚
â”œâ”€â”€ scripts/                       # è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ train.py                   # â­ ç»Ÿä¸€è®­ç»ƒå…¥å£
â”‚   â”œâ”€â”€ train_sl.py                # ç›‘ç£å­¦ä¹ è®­ç»ƒ
â”‚   â”œâ”€â”€ train_rl.py                # å¼ºåŒ–å­¦ä¹ è®­ç»ƒ
â”‚   â”œâ”€â”€ evaluate.py                # æ¨¡å‹è¯„ä¼°
â”‚   â””â”€â”€ preprocess_training_data.py # â­ æ•°æ®é¢„å¤„ç†
â”‚
â”œâ”€â”€ configs/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ encoder_ids.yaml          # â­ å¡ç‰Œ/é—ç‰©/è¯æ°´ ID æ˜ å°„è¡¨
â”‚   â””â”€â”€ default.yaml              # é»˜è®¤é…ç½®
â”‚
â”œâ”€â”€ data/                          # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ A20_Silent/                # é™é»˜çŒæ‰‹æ•°æ®
â”‚   â”‚   â””â”€â”€ Raw_Data_json_FORSL/  # Mod Log åŸå§‹æ•°æ®
â”‚   â”œâ”€â”€ training_data_*.json       # é¢„å¤„ç†åçš„è®­ç»ƒæ•°æ®
â”‚   â”œâ”€â”€ s_vectors.npy              # çŠ¶æ€çŸ©é˜µ (PyTorch è®­ç»ƒç”¨)
â”‚   â””â”€â”€ actions.npy                # åŠ¨ä½œæ ‡ç­¾ (PyTorch è®­ç»ƒç”¨)
â”‚
â”œâ”€â”€ docs/                          # æ–‡æ¡£
â”‚   â””â”€â”€ MOD_LOG_PARAMETERS.md      # Mod åè®®æ–‡æ¡£
â”‚
â”œâ”€â”€ rules_for_all.md               # å…¨å±€è§„åˆ™
â””â”€â”€ README.md                      # æœ¬æ–‡ä»¶
```

---

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.14+
- ã€Šæ€æˆ®å°–å¡”ã€‹æ¸¸æˆæœ¬ä½“
- [CommunicationMod](https://github.com/ForgottenArbiter/CommunicationMod)ï¼ˆå¯é€‰ï¼Œç”¨äºçœŸå®æ¸¸æˆï¼‰

### å®‰è£…ä¾èµ–

```bash
pip install numpy==1.26.4
pip install scipy scikit-learn pyyaml
pip install torch torchvision torchaudio
pip install gymnasium stable-baselines3
```

### æ•°æ®é¢„å¤„ç†

```bash
# å°† Mod Log è½¬æ¢ä¸ºè®­ç»ƒæ•°æ®
python scripts/preprocess_training_data.py \
    -i data/A20_Silent/Raw_Data_json_FORSL/Silent_A20_HUMAN_20260205_233501.json \
    -o data/training_data.json
```

è¾“å‡ºæ–‡ä»¶ï¼š
- `training_data.json` - å®Œæ•´è®­ç»ƒæ•°æ®ï¼ˆJSON æ ¼å¼ï¼‰
- `s_vectors.npy` - çŠ¶æ€çŸ©é˜µ
- `actions.npy` - åŠ¨ä½œæ ‡ç­¾

### è®­ç»ƒæ¨¡å‹

```bash
# å®Œæ•´è®­ç»ƒæµç¨‹
python scripts/train.py pipeline \
    --data-dir data/A20_Silent/Raw_Data_json_FORSL \
    --collect-games 50 \
    --sl-epochs 100 \
    --rl-timesteps 100000

# å•ç‹¬æ­¥éª¤
python scripts/train.py sl --data-dir data/    # ç›‘ç£å­¦ä¹ 
python scripts/train.py rl --sl-model models/sl.pkl  # å¼ºåŒ–å­¦ä¹ 
python scripts/train.py eval --agent-type rl       # è¯„ä¼°
```

---

## å¼€å‘æ–‡æ¡£

### ç¼–ç å™¨ä½¿ç”¨

```python
from src.training.encoder import encode, get_output_dim

# ä» Mod å“åº”ç”Ÿæˆ S å‘é‡
mod_response = {
    "game_state": {...},
    "available_commands": [...],
    ...
}

s_vector = encode(mod_response)
print(f"S å‘é‡ç»´åº¦: {len(s_vector)}")  # 2945
print(f"éé›¶å…ƒç´ : {(s_vector != 0).sum()}")
```

### ID æ˜ å°„ä½¿ç”¨

```python
from src.training.encoder_utils import card_id_to_index

# å¡ç‰Œ ID â†’ ç´¢å¼•
index = card_id_to_index("Backflip")  # é™é»˜å¡ç‰Œ
print(f"Backflip ç´¢å¼•: {index}")  # 0-143
```

### è‡ªå®šä¹‰è®­ç»ƒ

å‚è€ƒï¼š
- `scripts/train_sl.py` - ç›‘ç£å­¦ä¹ å®ç°
- `scripts/train_rl.py` - å¼ºåŒ–å­¦ä¹ å®ç°
- `src/agents/supervised.py` - Agent å®ç°

---

## æ›´æ–°æ—¥å¿—

### 2026-02-07ï¼šç¼–ç å™¨ V2 + æ•°æ®é¢„å¤„ç†

**çŠ¶æ€ç¼–ç å™¨æ›´æ–°**
- âœ… æ€»ç»´åº¦ï¼š2945 ç»´ï¼ˆé™é»˜ä¸“ç”¨ï¼‰
- âœ… æ–°å¢ï¼šæˆ˜æ–—åŠ¨æ€ä¿¡æ¯ï¼ˆ111ç»´ï¼‰
- âœ… æ–°å¢ï¼šç‰Œç»„å˜åŒ–ç»Ÿè®¡ï¼ˆ80ç»´ï¼‰
- âœ… åˆ é™¤ï¼šè§’è‰²/éš¾åº¦/Orbs ç¼–ç ï¼ˆé™é»˜ä¸ç”¨ï¼‰
- âœ… å¡ç‰Œæ± ï¼š144 å¼ ï¼ˆé™é»˜75 + è¯…å’’14 + çŠ¶æ€5 + æ— è‰²47ï¼‰

**æ–°å¢åŠŸèƒ½**
- âœ… æ•°æ®é¢„å¤„ç†è„šæœ¬ `scripts/preprocess_training_data.py`
- âœ… åŠ¨ä½œæ©ç ç”Ÿæˆï¼ˆæ”¯æŒ choose/play/end ç­‰æ‰€æœ‰å‘½ä»¤ï¼‰
- âœ… å®é™…åŠ¨ä½œæ¨æ–­ï¼ˆä»ç›¸é‚»è®°å½•æ¨æ–­ï¼‰
- âœ… æ‰¹é‡å¤„ç†æ”¯æŒ

**æ•°æ®å¤„ç†**
- âœ… ä» Mod Log ç”Ÿæˆ (s, a) è®­ç»ƒå¯¹
- âœ… æ”¯æŒ JSON å’Œ NumPy ä¸¤ç§è¾“å‡ºæ ¼å¼
- âœ… å®Œæ•´çš„å…ƒæ•°æ®è®°å½•

### 2026-02-06ï¼šé™é»˜ä¸“ç”¨ç¼–ç å™¨å®Œå–„

- å®Œå–„å¡ç‰Œæ± ï¼š144 å¼ å¡ç‰Œ
- åˆ é™¤å†—ä½™ç¼–ç ï¼šè§’è‰²/éš¾åº¦/Orbs
- è°ƒæ•´å‚æ•°ä¸Šé™ï¼šMAX_HP=200, MAX_BLOCK=999, MAX_ENERGY=20

### 2026-02-05ï¼šåˆå§‹ç‰ˆæœ¬

- åŠ¨ä½œç©ºé—´å®šä¹‰ï¼ˆ179 ç»´ï¼‰
- S å‘é‡ç¼–ç å™¨å®ç°
- åŸºç¡€è®­ç»ƒæ¡†æ¶

---

## å‚è€ƒèµ„æº

- [CommunicationMod](https://github.com/ForgottenArbiter/CommunicationMod) - æ¸¸æˆé€šä¿¡åè®®
- [Stable-Baselines3](https://github.com/DLR-RM/stable-baselines3) - RL æ¡†æ¶
- [Gymnasium](https://github.com/Farama-Foundation/Gymnasium) - RL ç¯å¢ƒæ ‡å‡†

---

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

MIT License
