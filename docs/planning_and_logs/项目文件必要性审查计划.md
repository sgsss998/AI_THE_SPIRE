# 项目文件必要性审查计划

> **模式**：计划模式  
> **目的**：遍历项目，对每个文件的存在必要性做合理解释；无强理由者标记为可删除。  
> **执行**：仅当用户明确下达「进入执行模式」后，才执行删除操作。

---

## 一、根目录

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `.gitignore` | **保留** | Git 忽略规则，必备 |
| `README.md` | **保留** | 项目入口说明，必备 |
| `configs/requirements.md` | **保留** | 依赖列表，必备 |
| `rules_for_all.md` | **保留** | Cursor 规则（RIPER-5 等），开发约束 |
| `Received` | **待定** | Mod 通信管道（stdin 重定向），运行时由 Mod/脚本创建；当前为空。若为占位可删，若 Mod 依赖其存在则保留 |
| `Sending` | **待定** | 同上，stdout 管道 |

---

## 二、configs/

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `default.yaml` | **保留** | 训练/游戏默认配置，被 `config.py` 加载 |
| `encoder_ids.yaml` | **保留** | 卡牌/遗物/药水/Power/Intent 穷尽映射表，encoder 核心数据源 |
| `requirements.md` | **保留** | Python 依赖列表 |

---

## 三、src/ 核心代码

### 3.1 src/core/

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `__init__.py` | **保留** | 包导出 |
| `action.py` | **保留** | 动作空间定义（80 维），全项目依赖 |
| `game_state.py` | **保留** | GameState 等数据结构，协议/环境/Agent 依赖 |
| `config.py` | **保留** | 配置加载，多脚本依赖 |

### 3.2 src/protocol/

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `__init__.py` | **保留** | 包导出 |
| `reader.py` | **保留** | 从 stdin 读 Mod JSON |
| `writer.py` | **保留** | 向 stdout 发命令 |
| `parser.py` | **保留** | ModProtocol，组合 reader+writer，collect/interactive/evaluate 依赖 |

### 3.3 src/env/

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `__init__.py` | **保留** | 包导出 |
| `sts_env.py` | **⚠️ 已损坏** | 依赖已删除的 `StateEncoder`，会 ImportError。若保留需改为使用 `encoder.encode(mod_response)`；若训练管线尚未搭建，可考虑删除或归档 |

### 3.4 src/agents/

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `__init__.py` | **保留** | 包导出 |
| `base.py` | **保留** | Agent 基类，rule/supervised/rl 依赖 |
| `rule_based.py` | **保留** | 规则 Agent，interactive/collect 可用，不依赖 encoder |
| `rl_agent.py` | **⚠️ 已损坏** | 依赖 `StateEncoder`，会 ImportError。同上，可删或修 |
| `supervised.py` | **⚠️ 已损坏** | 依赖 `StateEncoder`，会 ImportError。同上，可删或修 |

### 3.5 src/training/

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `__init__.py` | **保留** | 包导出 |
| `encoder.py` | **保留** | 1840 维 s 向量编码器，当前唯一 encoder |
| `encoder_utils.py` | **保留** | ID 查表、归一化，encoder 依赖 |
| `power_parser.py` | **保留** | 从 powers 解析力量/虚弱等，encoder 依赖 |
| `experiment.py` | **保留** | 实验跟踪，训练脚本可能用 |

---

## 四、scripts/

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `train.py` | **保留** | 统一训练入口，collect/sl/rl/pipeline/eval/interactive |
| `collect_data.py` | **保留** | 收集人类对局，依赖 protocol、agents、env |
| `train_sl.py` | **保留** | 监督学习训练（但 supervised agent 已损坏，运行会报错） |
| `train_rl.py` | **保留** | 强化学习训练（但 rl_agent 已损坏） |
| `evaluate.py` | **保留** | 评估 Agent |
| `interactive.py` | **保留** | 交互测试，rule_based 可用 |
| `read_state.py` | **保留** | 调试用，读取并打印状态 |
| `extract_mod_schema.py` | **保留** | 从 Mod 日志提取字段路径，排除法用 |
| `extract_ids_from_raw.py` | **保留** | 从 Raw_Data 提取 ID，补充 encoder_ids.yaml |
| `test_action_client.py` | **待定** | 动作测试客户端，连接 test_action_server，手动调试用。若无 socket 测试需求可删 |
| `test_action_server.py` | **待定** | 动作测试服务端。同上 |
| `README.md` | **保留** | 脚本说明 |

---

## 五、tests/

**已删除**：tests/ 目录已按用户要求全部移除。

---

## 六、docs/

### 6.1 根级文档

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `README.md` | **保留** | 文档索引 |
| `API.md` | **⚠️ 已过时** | 描述 StateEncoder、encode_state 等旧 API，与当前 encoder 不符。可更新或删 |
| `ARCHITECTURE.md` | **⚠️ 部分过时** | 架构说明，含 StateEncoder 等旧内容。可更新或删 |
| `杀戮尖塔_官方本体A20_卡牌遗物穷尽清单.md` | **保留** | 穷尽清单，YAML 更新依据 |
| `状态向量s_技术规范.md` | **保留** | s 向量技术规范，当前有效 |
| `状态向量s_前218维_表达式清单.md` | **可删** | 218 维为旧版设计，当前为 1840 维，与 encoder.py 不符，冗余 |

### 6.2 docs/rules/

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `00-index.md` | **保留** | 规则总览 |
| `01-game-flow.md` ~ `08-sts-ai-master-reference.md` | **保留** | 游戏规则、协议、参考 |
| `ACTION_ID_MAP.md` | **保留** | 动作 ID 映射 |
| `_extensions/.gitkeep` | **保留** | 占位，保持目录结构（MkDocs 等可能用） |

### 6.3 docs/planning_and_logs/

| 文件 | 必要性 | 说明 |
|------|--------|------|
| `状态向量s_穷尽计划_详细版.md` | **保留** | 1840 维详细规格，与 encoder.py 对应，当前有效 |
| `状态向量s_穷尽计划.md` | **保留** | 穷尽计划总览，与详细版互补 |
| `状态向量s_表达式与Mod转换_计划.md` | **可删** | 723 维旧版设计，与当前 1840 维不一致，冗余 |
| `DEVELOPMENT_LOG.md` | **可删** | 2026-02 分析报告，描述 StateEncoder、旧架构，已过时 |
| `rules.md` | **待定** | 规则相关，内容需确认 |
| `StS_AI开发计划-细颗粒度实施指南.md` | **待定** | 开发计划，可能仍有参考价值 |
| `实施检查清单-可打印.md` | **待定** | 检查清单，可能已过时 |
| `方案_Agent结合LLM_技术规范.md` | **可删** | 备选方案，若未采用可删 |
| `方案A_修改Mod记录人类动作_研究计划.md` | **可删** | 备选方案 |
| `方案B_代理界面采集人类数据_技术规范.md` | **可删** | 备选方案 |

---

## 七、删除建议汇总

### 7.1 明确可删（冗余/过时）

| 路径 | 理由 |
|------|------|
| `docs/状态向量s_前218维_表达式清单.md` | 218 维旧版，当前 1840 维 |
| `docs/planning_and_logs/状态向量s_表达式与Mod转换_计划.md` | 723 维旧版 |
| `docs/planning_and_logs/DEVELOPMENT_LOG.md` | 描述已删除的 StateEncoder，过时 |
| `docs/planning_and_logs/方案_Agent结合LLM_技术规范.md` | 备选方案，未采用 |
| `docs/planning_and_logs/方案A_修改Mod记录人类动作_研究计划.md` | 备选方案 |
| `docs/planning_and_logs/方案B_代理界面采集人类数据_技术规范.md` | 备选方案 |

### 7.2 待用户确认

| 路径 | 说明 |
|------|------|
| `Received`, `Sending` | 空文件，Mod 管道占位？ |
| `scripts/test_action_client.py`, `scripts/test_action_server.py` | 调试用 socket 测试，是否仍需 |
| `docs/planning_and_logs/rules.md` | 内容需确认 |
| `docs/planning_and_logs/StS_AI开发计划-细颗粒度实施指南.md` | 是否仍有参考价值 |
| `docs/planning_and_logs/实施检查清单-可打印.md` | 是否已过时 |
| `docs/API.md`, `docs/ARCHITECTURE.md` | 过时但可更新而非删除 |

### 7.3 已损坏（需修或删）

| 路径 | 说明 |
|------|------|
| `src/env/sts_env.py` | 依赖 StateEncoder，ImportError |
| `src/agents/rl_agent.py` | 同上 |
| `src/agents/supervised.py` | 同上 |
| `tests/test_env/test_sts_env.py` | 同上 |
| `tests/test_agents/test_supervised.py` | 同上 |
| `tests/test_agents/test_rl_agent.py` | 同上 |

**选项**：  
- A) 删除上述 6 个文件（训练管线尚未搭建，视为占位垃圾）  
- B) 修复：改为使用 `encoder.encode(mod_response)`，需重构输入格式（GameState → Mod JSON）

---

## 八、实施检查清单

**阶段 1：仅删明确冗余文档（无破坏性）** ✅ 已完成

1. [x] 删除 `docs/状态向量s_前218维_表达式清单.md`
2. [x] 删除 `docs/planning_and_logs/状态向量s_表达式与Mod转换_计划.md`
3. [x] 删除 `docs/planning_and_logs/DEVELOPMENT_LOG.md`
4. [x] 删除 `docs/planning_and_logs/方案_Agent结合LLM_技术规范.md`
5. [x] 删除 `docs/planning_and_logs/方案A_修改Mod记录人类动作_研究计划.md`
6. [x] 删除 `docs/planning_and_logs/方案B_代理界面采集人类数据_技术规范.md`

**阶段 2：待用户确认后执行**

7. [ ] 确认 `Received`、`Sending` 是否删除
8. [ ] 确认 `test_action_client.py`、`test_action_server.py` 是否删除
9. [ ] 确认 `rules.md`、`StS_AI开发计划-细颗粒度实施指南.md`、`实施检查清单-可打印.md` 是否删除
10. [ ] 确认 `API.md`、`ARCHITECTURE.md` 是更新还是删除

**阶段 3：已损坏文件（需用户明确选择 A 或 B）**

11. [ ] 若选 A：删除 sts_env、rl_agent、supervised 及对应测试
12. [ ] 若选 B：修复上述文件以使用新 encoder

---

**结论**：先执行阶段 1 可安全清理 6 个冗余文档；阶段 2、3 需用户确认后再执行。
