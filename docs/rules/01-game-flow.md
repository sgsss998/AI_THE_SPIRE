# 01 - 游戏流程

> **核心规则**：进入游戏后第一步、第二步…的确定顺序。

---

## 一局游戏阶段顺序

| 序号 | 阶段 | 说明 | Mod 标识 |
|-----|------|------|----------|
| 1 | 涅奥祝福 | 选择起始祝福（2 或 4 个选项） | `screen_type=EVENT`, `event_id=Neow Event` |
| 2 | 地图选节点 | 选择下一个要去的节点 | `screen_type=MAP` |
| 3 | 节点内容 | 战斗 / 商店 / 休息 / 事件 / 宝箱 | 由所选节点决定 |
| 4 | 战斗 | 回合制战斗 | `combat_state` 存在，`room_phase=COMBAT` |
| 5 | 战斗奖励 | 选牌、遗物、药水等 | `screen_type` 对应奖励界面 |
| 6 | 循环 | 返回阶段 2，直至 BOSS 或死亡 | - |

---

## 阶段 1：涅奥祝福

- **触发**：游戏开始，角色选定后。
- **结束**：玩家选择一项祝福并离开。
- **可用命令**：`choose`（选择选项索引）。
- **状态**：`game_state.screen_state.event_id = "Neow Event"`。

---

## 阶段 2：地图选节点

- **触发**：涅奥祝福后，或完成节点内容后。
- **结束**：玩家选择 `next_nodes` 中一个节点。
- **可用命令**：`choose`（选择节点，如 `x=0`、`x=3`）。
- **状态**：`game_state.screen_type = "MAP"`，`screen_state.next_nodes` 为可选节点列表。
- **注意**：`first_node_chosen=false` 时为首选，`true` 时为已选等待进入。

---

## 阶段 3：节点内容

根据所选节点类型进入不同子阶段：

| 节点类型 | 说明 |
|----------|------|
| 普通敌人 / 精英 | 进入阶段 4（战斗） |
| 商店 | 购买卡牌、遗物、药水，移除卡牌 |
| 休息处 | 休息（回血）或强化一张牌 |
| 事件 | 剧情选择，结果有好有坏 |
| 宝箱 | 获得金钱和遗物 |
| BOSS | 进入阶段 4（战斗），A20 第三阶段需连续打 2 个 |

---

## 阶段 4：战斗

- **触发**：进入战斗节点后。
- **子阶段**：
  1. 战斗开始动画 / 抽牌（`ready_for_command=false`）
  2. 出牌阶段（`ready_for_command=true`，`play` / `end` 可用）
- **结束**：所有敌人死亡（胜利）或玩家 HP 归零（失败）。
- **详见**：[02-combat-turn.md](./02-combat-turn.md)、[03-protocol.md](./03-protocol.md)。

---

## 阶段 5：战斗奖励

- **触发**：战斗胜利后。
- **内容**：三选一卡牌、遗物（精英/BOSS）、可能药水。
- **结束**：玩家完成选择，返回地图。

---

## 阶段 6：循环

- 完成阶段 5 后返回阶段 2。
- 击败第三阶段 BOSS 即通关（A20 需击败 2 个）。
- 玩家 HP 归零即游戏结束。
