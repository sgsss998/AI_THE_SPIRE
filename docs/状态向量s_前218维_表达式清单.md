# 状态向量 s 前 218 维 — 每维是啥、咋算的

> 方便你逐项对。每一维写清楚：叫啥、从 Mod 哪来的、怎么算。

---

## 区块 1：玩家核心 s[0]–s[17]（18 维）

| 索引  | 英文名                  | 中文名           | 从 Mod 哪读                                                 | 怎么算                             |
| --- | -------------------- | ------------- | -------------------------------------------------------- | ------------------------------- |
| 0   | hp_ratio             | 当前血量比例        | combat_state.player.current_hp、max_hp；没战斗时用 game_state 的 | 当前血/最大血，夹到 0~1                  |
| 1   | max_hp_norm          | 最大血量（归一化）     | player.max_hp 或 game_state.max_hp                        | 取 min(最大血, 999) 再除以 999         |
| 2   | block_norm           | 格挡（归一化）       | combat_state.player.block                                | 取 min(格挡, 50) 再除以 50            |
| 3   | energy_norm          | 当前能量（归一化）     | combat_state.player.energy                               | 取 min(能量, 10) 再除以 10            |
| 4   | max_energy_norm      | 最大能量（归一化）     | 暂时按 3，后面可从遗物推                                            | 取 min(3, 10) 再除以 10             |
| 5   | gold_norm            | 金币（归一化）       | game_state.gold                                          | 取 min(金币, 999) 再除以 999          |
| 6   | strength_norm        | 力量（归一化）       | 从 player.powers 里找 Strength、Anger、Flex 等                 | 把这些的 amount 加起来，取 min(和, 30)/30 |
| 7   | dexterity_norm       | 敏捷（归一化）       | 从 player.powers 里找 Dexterity                             | 同上，取 min(和, 30)/30              |
| 8   | weak_norm            | 虚弱层数（归一化）     | 从 player.powers 里找 Weakened、Weak                         | 取 min(和, 10)/10                 |
| 9   | vulnerable_norm      | 易伤层数（归一化）     | 从 player.powers 里找 Vulnerable                            | 取 min(和, 10)/10                 |
| 10  | frail_norm           | 脆弱层数（归一化）     | 从 player.powers 里找 Frail                                 | 取 min(和, 10)/10                 |
| 11  | focus_norm           | 集中值（归一化，缺陷用）  | 从 player.powers 里找 Bias、Focus（猎人一般为 0，除非拿到棱镜，这是机器人专属）    | 取 min(和, 10)/10                 |
| 12  | hand_count_norm      | 手牌数量（归一化）     | len(combat_state.hand)                                   | 取 min(手牌数, 10)/10               |
| 13  | draw_count_norm      | 抽牌堆数量（归一化）    | len(combat_state.draw_pile)                              | 取 min(抽牌堆张数, 50)/50             |
| 14  | discard_count_norm   | 弃牌堆数量（归一化）    | len(combat_state.discard_pile)                           | 取 min(弃牌堆张数, 50)/50             |
| 15  | exhaust_count_norm   | 消耗堆数量（归一化）    | len(combat_state.exhaust_pile)                           | 取 min(消耗堆张数, 30)/30             |
| 16  | cards_discarded_norm | 本回合已弃牌数（归一化）  | combat_state.cards_discarded_this_turn                   | 取 min(数, 10)/10                 |
| 17  | times_damaged_norm   | 本回合已受伤次数（归一化） | combat_state.times_damaged                               | 取 min(数, 50)/50                 |

---

## 区块 2a：手牌 multi-hot s[18]–s[217]（200 维）

**multi-hot**：多热编码，一张卡对应一个位置，有几张就填几（可以大于 1）

| 索引范围     | 英文名               | 中文名                | 从 Mod 哪读               | 怎么算                                         |
| -------- | ----------------- | ------------------ | ---------------------- | ------------------------------------------- |
| 18 ~ 217 | card_0 ~ card_199 | 第 0~199 号卡牌在手牌里的张数 | combat_state.hand[].id | 手牌里每张卡按 id 查表得到编号 k，s[18+k] 加 1；同一张卡多张就多加几次 |

**查表**：用 `card_id_to_index(卡牌id)` 得到 k；找不到就 k=0（UNKNOWN 未知卡）。

**编号对应**（configs/encoder_v2_ids.yaml 里的 cards 列表）：
- 0: UNKNOWN（未知）
- 1: AscendersBane（进阶之灾）
- 2: Slimed（黏液）
- 3: Dazed（眩晕）
- … 一共 200 个，具体看 yaml 文件

---

## 代码在哪

- `src/training/encoder_utils.py`：normalize_id（把 id 统一格式）、card_id_to_index（卡牌 id 查编号）
- `src/training/power_parser.py`：从 powers 里解析力量、敏捷、虚弱、易伤、脆弱、集中
- `src/training/encoder_v2.py`：encode（主入口）、_encode_block1_player_core、_encode_block2a_hand_multihot
